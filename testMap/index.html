<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <title>SiGEN Test Map</title>

  <!-- Calcite Bootstrap -->
  <link rel="stylesheet" href="https://esri.github.io/calcite-maps/dist/css/calcite-bootstrap.min-v0.2.css">

  <!-- Calcite Maps -->
  <link rel="stylesheet" href="https://esri.github.io/calcite-maps/dist/css/calcite-maps-arcgis-4.x.min-v0.2.css">

  <!-- ArcGIS JS 4.0 -->
  <link rel="stylesheet" href="https://js.arcgis.com/4.0/esri/css/main.css">

  <style>
    html,
    body {
      margin: 0;
      padding: 0;
      width: auto;
      height: 900px;
    }
    #header{
      padding: 0;
      margin: 0;
      border:0;
      width: 100%;
      height: 100px;
      background: blue;
    } 
    #containerMenuPic{
      padding: 0;
      margin: 0;
      border: 0;
      height: 840px;
      width: 100%;
    }
    #menu{
      float: left;
      width: 20%;
      background: yellow;
      height: 875px;
    }
    #panorama{
      float:right;
      width: 80%;
    }
    #infoDiv {
      position: absolute;
      bottom: 55px;
      right: 20px;
      max-height: 80%;
      max-width: 300px;
      background-color: gray;
      padding: 8px;
      color: white;
      opacity: 0.8;
    }
    .navbar{
      position: relative;
    }
    .calcite-map.calcite-map-absolute {
      position: relative;
      height: 830px;
    }
    .calcite-nav-top .calcite-panels, .calcite-nav-top-fixed .calcite-panels {
      top: 155px;
    }

  </style>

</head>
<body>
  <div id="header"></div>
  <div id="containerMenuPic">
    <div id="menu"></div>
    
    <div id="panorama"> 

      <div class="calcite-maps calcite-nav-top">

        <!-- Navbar -->

        <nav class="navbar calcite-navbar navbar-fixed-top calcite-text-dark calcite-bg-light">
            <!-- Menu -->
            <div class="dropdown calcite-dropdown calcite-text-dark calcite-bg-light" role="presentation">
                <a class="dropdown-toggle" role="button" aria-haspopup="true" aria-expanded="false">
                    <div class="calcite-dropdown-toggle">
                        <span class="sr-only">Toggle dropdown menu</span>
                        <span></span>
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </a>
                <ul class="dropdown-menu">
                    <li class="active"><a class="hidden-md hidden-lg" href="#2dTab" aria-controls="2Dtab" role="tab"
                                          data-toggle="tab"> 2D</a></li>
                    <li><a class="hidden-md hidden-lg" href="#3dTab" aria-controls="3Dtab" role="tab"
                           data-toggle="tab"> 3D</a></li>
                    <li>
                        <a role="button" data-target="#panelBasemaps" aria-haspopup="true"><span class="glyphicon glyphicon-th-large"></span> Catografía</a>
                    </li>
                    <li>
                        <a role="button" data-target="#panelSettings" aria-haspopup="true"><span class="glyphicon glyphicon-cog"></span> Configuración</a>
                    </li>
                </ul>
            </div>
            <!-- Title -->
            <div class="calcite-title calcite-overflow-hidden">
                <span class="calcite-title-main">Panorama</span>
                <span class="calcite-title-divider hidden-xs"></span>
                <span class="calcite-title-sub hidden-xs">Información ficticia. Sólo para efectos de entrenamiento</span>
            </div>
            <!-- Nav -->
            <ul class="nav navbar-nav calcite-nav">
                <li class="active"><a id="mapNav" class="hidden-xs hidden-sm" href="#2dTab" aria-controls="2Dtab"
                                      aria-expanded="true" role="tab" data-toggle="tab" data-tooltip="tip" title="2D View"
                                      data-placement="bottom"> 2D</a></li>
                <li><a id="sceneNav" class="hidden-xs hidden-sm" href="#3dTab" aria-controls="3Dtab"
                       role="tab" data-toggle="tab" data-tooltip="tip" title="3D View" data-placement="bottom"> 3D</a></li>
                <li>
                    <div class="calcite-navbar-search calcite-search-expander">
                        <div id="searchWidgetDiv"></div>
                    </div>
                </li>
            </ul>
        </nav>
        <!--/.calcite-navbar -->

        <!-- Map  -->

        <div class="calcite-map calcite-map-absolute">
            <div id="tabContainer" class="tab-content">
                <div id="2dTab" class="tab-pane fade in active" role="tabpanel">
                    <div id="mapViewDiv"></div>
                </div>
                <div id="3dTab" class="tab-pane fade" role="tabpanel">
                    <div id="sceneViewDiv"></div>
                </div>
            </div>
        </div>
        <!-- /.calcite-map -->

        <!-- Panels -->

        <div class="calcite-panels calcite-panels-right calcite-text-dark calcite-bg-light panel-group">

            <!-- Basemaps Panel -->

            <div id="panelBasemaps" class="panel collapse">
                <div id="headingBasemaps" class="panel-heading" role="tab">
                    <div class="panel-title">
                        <a class="panel-toggle collapsed" role="button" data-toggle="collapse" href="#collapseBasemaps"
                           aria-expanded="false" aria-controls="collapseBasemaps"><span class="glyphicon glyphicon-th-large" aria-hidden="true"></span><span class="panel-label"> Cartografía</span></a>
                        <a class="panel-close" role="button" data-toggle="collapse" data-target="#panelBasemaps"><span class="esri-icon esri-icon-close" aria-hidden="true"></span></a>
                    </div>
                </div>
                <div id="collapseBasemaps" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingBasemaps">
                    <div class="panel-body">
                        <select id="selectBasemapPanel" class="form-control">
                            <option value="streets" data-vector="streets-vector">Streets</option>
                            <option value="satellite" data-vector="satellite" selected="">Satellite</option>
                            <option value="hybrid" data-vector="hybrid">Hybrid</option>
                            <option value="national-geographic" data-vector="national-geographic">National Geographic</option>
                            <option value="topo" data-vector="topo-vector">Topographic</option>
                            <option value="gray" data-vector="gray-vector">Gray</option>
                            <option value="dark-gray" data-vector="dark-gray-vector">Dark Gray</option>
                            <option value="osm" data-vector="osm">Open Street Map</option>
                            <option value="dark-gray" data-vector="streets-night-vector">Streets Night</option>
                            <option value="streets" data-vector="streets-navigation-vector">Streets Mobile</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Panel Settings -->

            <div id="panelSettings" class="panel panel-map collapse">
                <div id="headingSettings" class="panel-heading">
                    <div class="panel-title">
                        <a class="panel-toggle" role="button" data-toggle="collapse" href="#collapseSettings"
                           data-parent="#panelAccordion" aria-expanded="true" aria-controls="collapseSettings"><span class="glyphicon glyphicon-cog" aria-hidden="true"></span><span class="panel-label"> Configuración</span></a>
                        <a class="panel-close" role="button" data-toggle="collapse" data-target="#panelSettings"><span class="esri-icon esri-icon-close" aria-hidden="true"></span></a>
                    </div>
                </div>
                <div id="collapseSettings" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingSettings">
                    <div class="panel-body">
                        <div class="form-horizontal">

                            <!-- Theme -->

                            <div class="form-group">
                                <label for="settingsTheme" class="col-xs-3 control-label"> Tema</label>
                                <div class="col-xs-9">
                                    <select id="settingsTheme" class="form-control">
                                        <option value="calcite-dark" data-textcolor="calcite-text-light" data-bgcolor="calcite-bg-dark" selected>Calcite Dark</option>
                                        <option value="calcite-light" data-textcolor="calcite-text-dark" data-bgcolor="calcite-bg-light">Calcte Light</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Color -->

                            <div class="form-group">
                                <label for="settingsColor" class="col-xs-3 control-label"> Color</label>
                                <div class="col-xs-9">
                                    <select id="settingsColor" class="form-control">
                                        <option value="" data-theme="calcite-theme-light">Calcite Default</option>
                                        <option value="calcite-bgcolor-dark-blue" data-textcolor="calcite-text-light" data-bgcolor="calcite-bg-custom">Calcite Dark Blue</option>
                                        <option value="calcite-bgcolor-dark-green" data-textcolor="calcite-text-light" data-bgcolor="calcite-bg-custom">Calcite Dark Green</option>
                                        <option value="calcite-bgcolor-dark-brown" data-textcolor="calcite-text-light" data-bgcolor="calcite-bg-custom">Calcite Dark Brown </option>
                                        <option value="calcite-bgcolor-dark-red" data-textcolor="calcite-text-light" data-bgcolor="calcite-bg-custom">Calcite Dark Red</option>
                                        <option value="calcite-bgcolor-darkest-grey" data-textcolor="calcite-text-light" data-bgcolor="calcite-bg-custom">Calcite Darkest Grey</option>
                                        <option value="calcite-bgcolor-lightest-grey" data-textcolor="calcite-text-dark" data-bgcolor="calcite-bg-custom">Calcite Lightest Grey</option>
                                        <option value="calcite-bgcolor-blue-75" data-textcolor="calcite-text-light" data-bgcolor="calcite-bg-custom">Calcite Blue 75%</option>
                                        <option value="calcite-bgcolor-black-75" data-textcolor="calcite-text-light" data-bgcolor="calcite-bg-custom">Calcite Black 75%</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Widgets -->

                            <div class="form-group">
                                <label for="settingsWidgets" class="col-xs-3 control-label"> Botones</label>
                                <div class="col-xs-9">
                                    <select id="settingsWidgets" class="form-control">
                                        <option value="calcite-widgets-dark">Calcite Dark</option>
                                        <option value="calcite-widgets-light" selected>Calcite Light</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- /.calcite-panels -->

        <script type="text/javascript">
            var dojoConfig = {
                packages: [{
                    name: "bootstrap",
                    location: "https://esri.github.io/calcite-maps/dist/vendor/dojo-bootstrap"
                },
                    {
                        name: "calcite-maps",
                        location: "https://esri.github.io/calcite-maps/dist/js/dojo"
                    }]
            };
        </script>

        <!-- ArcGIS JS 4.0 -->
        <script src="https://js.arcgis.com/4.0/"></script>

        <script>
            var app;

            require([
                "esri/Map",
                "esri/views/MapView",
                "esri/views/SceneView",
                "esri/widgets/Search",
                "esri/widgets/Popup",
                "esri/core/watchUtils",
                "esri/widgets/Home",
                "dojo/query",
                "dojo/on",

                // Bootstrap
                "bootstrap/Collapse",
                "bootstrap/Dropdown",
                "bootstrap/Tab",

                // Calcite Maps
                "calcite-maps/calcitemaps-v0.2",
                "dojo/domReady!"
            ], function(Map, MapView, SceneView, Search, Popup, watchUtils, Home, query,
                        on) {

                /******************************************************************
                 *
                 * App settings
                 *
                 ******************************************************************/

                app = {
                    center: [-70.669,-33.448],
                    scale: 40000000,
                    basemap: "hybrid",
                    viewPadding: {
                        top: 0,
                        bottom: 0
                    },
                    uiComponents: ["zoom", "compass", "attribution"],
                    dockOptions: {
                        position: "bottom-right",
                        // Custom docking breakpoints
                    },
                    mapView: null,
                    sceneView: null,
                    activeView: null,
                    searchWidget: null,
                    homeBtn: null,
                    screenWidth: 0
                };

                /******************************************************************
                 *
                 * Create the map and scene view and ui components
                 *
                 ******************************************************************/

                // Map
                var map = new Map({
                    basemap: app.basemap
                });
                app.mapView = new MapView({
                    container: "mapViewDiv",
                    map: map,
                    center: app.center,
                    scale: app.scale,
                    padding: app.viewPadding,
                    popup: new Popup({
                        dockOptions: app.dockOptions
                    }),
                    ui: {
                        components: app.uiComponents
                    }
                });

                // Scene
                var mapScene = new Map({
                    basemap: app.basemap,
                    ground: "world-elevation"
                });
                app.sceneView = new SceneView({
                    container: "sceneViewDiv",
                    map: mapScene,
                    center: app.center,
                    scale: app.scale,
                    padding: app.viewPadding,
                    popup: new Popup({
                        dockOptions: app.dockOptions
                    }),
                    ui: {
                        components: app.uiComponents
                    }
                });

                // Set the active view to scene
                app.activeView = app.mapView;

                // Create the search widget and add it to the navbar instead of view
                app.searchWidget = new Search({
                    view: app.activeView
                }, "searchWidgetDiv");
                app.searchWidget.startup();


                app.homeBtn = new Home({
                  view: app.activeView
                });
                app.homeBtn.startup();
                app.mapView.ui.add(app.homeBtn,"top-left");





                /******************************************************************
                 *
                 * Synchronize the view, search and popup
                 *
                 ******************************************************************/

                // Tab - toggle between map and scene view
                query(".calcite-navbar li a[data-toggle='tab']").on("click", function(
                        e) {
                    syncTabs(e);
                    if (e.target.text.indexOf("Map") > -1) {
                        syncViews(app.sceneView, app.mapView);
                        app.activeView = app.mapView;
                    } else {
                        syncViews(app.mapView, app.sceneView);
                        app.activeView = app.sceneView;
                    }
                    syncSearch();
                });

                // Tabs - sync ui menus
                function syncTabs(e) {
                    query(".calcite-navbar li.active").removeClass("active");
                    query(e.target).addClass("active");
                }

                // Views - sync viewpoint and popup
                function syncViews(fromView, toView) {
                    watchUtils.whenTrueOnce(toView, "ready").then(function(result) {
                        watchUtils.whenTrueOnce(toView, "stationary").then(function(
                                result) {
                            toView.goTo(fromView.viewpoint);
                            toView.popup.reposition();
                        });
                    });
                }

                // Search - sync search location and popup
                function syncSearch() {
                    app.searchWidget.view = app.activeView;
                    if (app.searchWidget.selectedResult) {
                        app.searchWidget.search(app.searchWidget.selectedResult.name);
                        app.activeView.popup.reposition();
                    }
                }

                /******************************************************************
                 *
                 * Show and hide the panels and popup
                 *
                 ******************************************************************/

                // Views - Listen to view size changes to show/hide panels
                app.mapView.watch("size", viewSizeChange);
                app.sceneView.watch("size", viewSizeChange);

                function viewSizeChange(screenSize) {
                    if (app.screenWidth !== screenSize[0]) {
                        app.screenWidth = screenSize[0];
                        setPanelVisibility();
                    }
                }

                // Popups - Listen to popup changes to show/hide panels
                app.mapView.popup.watch(["visible", "currentDockPosition"],
                        setPanelVisibility);
                app.sceneView.popup.watch(["visible", "currentDockPosition"],
                        setPanelVisibility);

                // Panels - Show/hide the panel when popup is docked
                function setPanelVisibility() {
                    var isMobileScreen = app.activeView.widthBreakpoint === "xsmall" ||
                                    app.activeView.widthBreakpoint === "small",
                            isDockedVisible = app.activeView.popup.visible && app.activeView.popup
                                            .currentDockPosition,
                            isDockedBottom = app.activeView.popup.currentDockPosition && app.activeView
                                            .popup.currentDockPosition.indexOf("bottom") > -1,
                            isDockedTop = app.activeView.popup.currentDockPosition && app.activeView
                                            .popup.currentDockPosition.indexOf("top") > -1;
                    // Mobile (xsmall/small)
                    if (isMobileScreen) {
                        if (isDockedVisible && isDockedBottom) {
                            query(".calcite-panels").addClass("invisible");
                        } else {
                            query(".calcite-panels").removeClass("invisible");
                        }
                    } else { // Desktop (medium+)
                        if (isDockedVisible && isDockedTop) {
                            query(".calcite-panels").addClass("invisible");
                        } else {
                            query(".calcite-panels").removeClass("invisible");
                        }
                    }
                }

                // Panels - Dock popup when panels show (desktop or mobile)
                query(".calcite-panels .panel").on("show.bs.collapse", function(e) {
                    if (app.activeView.popup.currentDockPosition || app.activeView.widthBreakpoint ===
                            "xsmall") {
                        app.activeView.popup.dockEnabled = false;
                    }
                });

                // Panels - Undock popup when panels hide (mobile only)
                query(".calcite-panels .panel").on("hide.bs.collapse", function(e) {
                    if (app.activeView.widthBreakpoint === "xsmall") {
                        app.activeView.popup.dockEnabled = true;
                    }
                });

                /******************************************************************
                 *
                 * Apply Calcite Maps CSS classes to change application on the fly
                 *
                 * For more information about the CSS styles or Sass build visit:
                 * http://github.com/esri/calcite-maps
                 *
                 ******************************************************************/

                var cssSelectorUI = ".calcite-navbar, .calcite-panels",
                        cssSelectorMap = ".calcite-map";

                // Theme - light (default) or dark theme
                query("#settingsTheme").on("change", function(e) {
                    var textColor = e.target.options[e.target.selectedIndex].dataset
                                    .textcolor,
                            bgColor = e.target.options[e.target.selectedIndex].dataset.bgcolor;
                    query(cssSelectorUI).removeClass(
                            "calcite-text-dark calcite-text-light calcite-bg-dark calcite-bg-light calcite-bg-custom"
                    ).addClass(textColor + " " + bgColor);
                    query(cssSelectorUI).removeClass(
                            "calcite-bgcolor-dark-blue calcite-bgcolor-blue-75 calcite-bgcolor-dark-green calcite-bgcolor-dark-brown calcite-bgcolor-darkest-grey calcite-bgcolor-lightest-grey calcite-bgcolor-black-75 calcite-bgcolor-dark-red"
                    ).addClass(bgColor);
                    query("#settingsColor").attr("value", "");
                });

                // Color - custom color
                query("#settingsColor").on("change", function(e) {
                    var customColor = e.target.value,
                            textColor = e.target.options[e.target.selectedIndex].dataset.textcolor,
                            bgColor = e.target.options[e.target.selectedIndex].dataset.bgcolor;
                    query(cssSelectorUI).removeClass(
                            "calcite-text-dark calcite-text-light calcite-bg-dark calcite-bg-light calcite-bg-custom"
                    ).addClass(textColor + " " + bgColor);
                    query(cssSelectorUI).removeClass(
                            "calcite-bgcolor-dark-blue calcite-bgcolor-blue-75 calcite-bgcolor-dark-green calcite-bgcolor-dark-brown calcite-bgcolor-darkest-grey calcite-bgcolor-lightest-grey calcite-bgcolor-black-75 calcite-bgcolor-dark-red"
                    ).addClass(customColor);
                    if (!customColor) {
                        on.emit(query("#settingsTheme")[0], "change", {
                            bubbles: true,
                            cancelable: true
                        });
                    }
                });

                // Widgets - light (default) or dark theme
                query("#settingsWidgets").on("change", function(e) {
                    var theme = e.target.value;
                    query(cssSelectorMap).removeClass(
                            "calcite-widgets-dark calcite-widgets-light").addClass(
                            theme);
                });

                // Layout - top or bottom nav position
                query("#settingsLayout").on("change", function(e) {
                    var layout = e.target.value;
                    var layoutNav = e.target.options[e.target.selectedIndex].dataset
                            .nav;
                    query("body").removeClass("calcite-nav-bottom calcite-nav-top")
                            .addClass(layout);
                    query("nav").removeClass("navbar-fixed-bottom navbar-fixed-top")
                            .addClass(layoutNav);
                    setViewPadding(layout);
                });

                // Basemap events
                query("#selectBasemapPanel").on("change", function(e) {
                    app.mapView.map.basemap = e.target.options[e.target.selectedIndex]
                            .dataset.vector;
                    app.sceneView.map.basemap = e.target.value;
                });

                // Set view padding for widgets based on navbar position
                function setViewPadding(layout) {
                    var padding, uiPadding;
                    // Top
                    if (layout === "calcite-nav-top") {
                        padding = {
                            padding: {
                                top: 50,
                                bottom: 0
                            }
                        };
                        uiPadding = {
                            padding: {
                                top: 15,
                                right: 15,
                                bottom: 30,
                                left: 15
                            }
                        };
                    } else { // Bottom
                        padding = {
                            padding: {
                                top: 0,
                                bottom: 50
                            }
                        };
                        uiPadding = {
                            padding: {
                                top: 30,
                                right: 15,
                                bottom: 15,
                                left: 15
                            }
                        };
                    }
                    app.mapView.set(padding);
                    app.mapView.ui.set(uiPadding);
                    app.sceneView.set(padding);
                    app.sceneView.ui.set(uiPadding);
                    // Reset popup
                    if (app.activeView.popup.visible && app.activeView.popup.dockEnabled) {
                        app.activeView.popup.visible = false;
                        app.activeView.popup.visible = true;
                    }
                }

            });
        </script>
      </div>
    </div>
  </div>
</body>
</html>